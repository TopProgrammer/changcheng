<!doctype html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登陆中心</title>

    <link rel="stylesheet" type="text/css" href="../css/styles.css">

</head>
<body>


<div class="wrapper">

    <div id="backpic">
    <div class="container">
        <h1>长城登陆中心</h1>
        <form class="form">
            <input id="username" type="text" placeholder="用户名">
            <input id="password" type="password" placeholder="密码">
            <div>
                <input name="picCaptcha" id="picCaptcha" type="code" placeholder="验证码">
                <img id="validateCodeImage" alt="" src="http://local.obaymax.com:7000/valiedate/loginCode">
                </input>
            </div>
            <button type="submit" id="login-button">登录</button>
        </form>
    </div>
    </div>
</div>

<script type="text/javascript" src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/jquerysession.js" type="text/javascript" language="javascript"></script>
<script src="../js/jquery.validate.js" type="text/javascript" language="javascript"></script>
<script type="text/javascript">
    $("#validateCodeImage").click(function () {
        $("#validateCodeImage")[0].src = "http://local.obaymax.com:7000/valiedate/loginCode?" + (new Date).getTime();
    });
    $('#login-button').click(function (event) {
        event.preventDefault();
        var username = $("#username").val();
        var password = $("#password").val();
        var picCaptcha = $.trim($("#picCaptcha").val());
        var fromUrl = $.getUrlParam("fromurl");


        $.ajax({
            url: "http://local.obaymax.com:7000/user/login",
            type: "post",
            dataType: "json",
            xhrFields: {
                withCredentials: true // 确保请求会携带上Cookie
            },
            data: JSON.stringify({
                "username": username,
                "password": password,
                "picCaptcha": picCaptcha,
                "fromUrl": fromUrl
            }),
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Content-Type", "application/json"); // 设置请求协议，会触发PreFlight
            },
            complete: function (respResult) {
                $('form').fadeOut(500);
                $('.wrapper').addClass('form-success');

            }
        });

    });



    /*获取到Url里面的参数*/
    (function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
    })(jQuery);
</script>

</body>
</html>